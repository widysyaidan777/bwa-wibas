<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Peta Topologi – BWA WiBAS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }

    header {
      height: 64px;
      background: linear-gradient(90deg,#0f172a,#020617);
      color: white;
      padding: 16px;
      box-sizing: border-box;
      display: flex;
      align-items: center;
    }

    /* ===== SIDEBAR ===== */
    #sidebar {
      position: fixed;
      top: 64px;
      left: 0;
      width: 220px;
      height: calc(100vh - 64px);
      background: #1e293b;
      color: white;
      padding: 10px;
      box-sizing: border-box;
      z-index: 1000;
      transition: transform 0.3s ease;
    }

    #sidebar.hide {
      transform: translateX(-100%);
    }

    #sidebar h3 {
      margin-top: 0;
      font-size: 16px;
    }

    .node-btn {
      width: 100%;
      margin-bottom: 8px;
      padding: 10px;
      border: none;
      border-radius: 4px;
      background: #3b82f6;
      color: white;
      cursor: pointer;
      text-align: left;
    }

    .node-btn:hover {
      background: #2563eb;
    }

    /* ===== TOGGLE BUTTON ===== */
    #toggle-btn {
      position: absolute;
      top: 10px;
      right: -30px;
      width: 30px;
      height: 40px;
      background: #1e293b;
      color: white;
      border-radius: 0 6px 6px 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    /* ===== MAP ===== */
    #map {
      margin-left: 220px;
      height: calc(100vh - 64px);
      transition: margin-left 0.3s ease;
    }

    #map.full {
      margin-left: 0;
    }

    #back-button {
      position: absolute;
      bottom: 10px;
      left: 10px;
      z-index: 1200;
      padding: 10px 15px;
      background-color: #333;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    /* ===== BLINK STATUS ===== */
    @keyframes blinkBlue {
      0% { opacity: 1; }
      50% { opacity: 0.2; }
      100% { opacity: 1; }
    }

    @keyframes blinkRed {
      0% { opacity: 1; }
      50% { opacity: 0.2; }
      100% { opacity: 1; }
    }

    .status-up {
      animation: blinkBlue 1s infinite;
    }

    .status-down {
      animation: blinkRed 1s infinite;
    }
  </style>
</head>

<body>

<header>
  <h2>Peta Topologi – BWA WiBAS</h2>
</header>

<!-- SIDEBAR -->
<div id="sidebar">
  <div id="toggle-btn" onclick="toggleSidebar()">◀</div>

  <h3>Daftar Node</h3>
  <button class="node-btn" onclick="showAllNodes()">All</button>
  <button class="node-btn" onclick="showNode('node1')">Node 1</button>
  <button class="node-btn" onclick="showNode('node2')">Node 2</button>
  <button class="node-btn" onclick="showNode('node3')">Node 3</button>
</div>

<div id="map"></div>

<button id="back-button" onclick="window.location.href='index.html';">
  Kembali ke Menu
</button>

<script>
  /* ===== SIDEBAR ===== */
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const mapDiv = document.getElementById('map');
    const toggle = document.getElementById('toggle-btn');

    sidebar.classList.toggle('hide');
    mapDiv.classList.toggle('full');
    toggle.innerHTML = sidebar.classList.contains('hide') ? '▶' : '◀';
  }

  /* ===== MAP INIT ===== */
  const map = L.map('map').setView([-6.291, 106.786], 11.8);

  L.tileLayer('https://api.maptiler.com/maps/streets-v4/{z}/{x}/{y}.png?key=fI3LpQe8kMXj5ntFo68C', {
    attribution: '© MapTiler © OpenStreetMap contributors'
  }).addTo(map);

  /* ===== SECTOR ===== */
  function getSectorCoordinates(center, angle, radius) {
    const rad = angle * Math.PI / 180;
    return [
      center[0] + radius * Math.cos(rad),
      center[1] + radius * Math.sin(rad)
    ];
  }

  function drawSector(center, start, end, radius, color) {
    const coords = [center];
    if (start < end) {
      for (let a = start; a <= end; a++) coords.push(getSectorCoordinates(center, a, radius));
    } else {
      for (let a = start; a <= 360; a++) coords.push(getSectorCoordinates(center, a, radius));
      for (let a = 0; a <= end; a++) coords.push(getSectorCoordinates(center, a, radius));
    }
    return L.polygon(coords, { color, fillColor: color, fillOpacity: 0.45 });
  }

  /* ===== NODE SYSTEM ===== */
  const nodes = {};

  function createNode(name, center, status) {
    const isUp = status === 'up';
    const color = isUp ? 'blue' : 'red';
    const blinkClass = isUp ? 'status-up' : 'status-down';

    const layers = [
      drawSector(center, 45, 135, 0.05, color),
      drawSector(center, 135, 225, 0.05, color),
      drawSector(center, 225, 315, 0.05, color),
      drawSector(center, 315, 45, 0.05, color),
      L.circleMarker(center, {
        radius: 9,
        color,
        fillColor: color,
        fillOpacity: 0.9,
        className: blinkClass
      }).bindPopup(`<b>${name}</b><br>Status: ${status.toUpperCase()}`)
    ];

    nodes[name] = { layers, center };
  }

  /* ===== CREATE NODES ===== */
  createNode('node1', [-6.291, 106.786], 'up');
  createNode('node2', [-6.260, 106.800], 'down');
  createNode('node3', [-6.320, 106.760], 'up');

  function clearMap() {
    Object.values(nodes).forEach(n =>
      n.layers.forEach(l => map.removeLayer(l))
    );
  }

  function showNode(name) {
    clearMap();
    nodes[name].layers.forEach(l => l.addTo(map));
    map.flyTo(nodes[name].center, 12.5, { duration: 0.8 });
  }

  function showAllNodes() {
    clearMap();
    Object.values(nodes).forEach(n =>
      n.layers.forEach(l => l.addTo(map))
    );
  }

  showAllNodes();
</script>

</body>
</html>
