<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Topology Map - BWA WiBAS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
}

header {
  background: linear-gradient(90deg,#0f172a,#020617);
  color: white;
  padding: 16px;
}

#map {
  height: calc(100vh - 80px);
}
</style>
</head>

<body>

<header>
  <h2>Topology Map – BWA WiBAS</h2>
</header>

<div id="map"></div>
<nav>
  <a href="index.html">Home</a>
  <a href="data.html">Data</a>
  <a href="map.html">Map</a>
</nav>
<script>
  const map = L.map('map').setView([-6.291, 106.786], 5);  // Atur posisi default peta
  
  // Menambahkan Tile Layer (Peta)
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap'
  }).addTo(map);

  const csvFile = 'data.csv';  // Nama file CSV

  fetch(csvFile)
    .then(res => res.text())
    .then(text => {
      const lines = text.trim().split(/\r?\n/);
      const headers = lines[0].split(',').map(h => h.trim());

      const latCol = headers.find(h => h.toLowerCase().includes('latitude'));
      const lonCol = headers.find(h => h.toLowerCase().includes('longitude'));
      const nodeCol = headers.find(h => h.toLowerCase().includes('node'));
      const areaCol = headers.find(h => h.toLowerCase().includes('area'));
      const regionCol = headers.find(h => h.toLowerCase().includes('region'));

      // Memastikan kolom Latitude dan Longitude ditemukan
      if (!latCol || !lonCol || !nodeCol) {
        console.error("Kolom latitude, longitude atau node tidak ditemukan.");
        return;
      }

      // Proses setiap baris dalam CSV
      lines.slice(1).forEach(line => {
        const values = line.split(',');
        const row = {};
        headers.forEach((header, i) => row[header] = values[i]);

        // Mengambil data latitude dan longitude
        const lat = parseFloat(row[latCol]);
        const lon = parseFloat(row[lonCol]);

        // Pastikan lat dan lon valid
        if (isNaN(lat) || isNaN(lon)) return; // Jika data lat/lon tidak valid, skip

        const node = row[nodeCol];
        const popupContent = `
          <b>Node:</b> ${node}<br>
          <b>Area:</b> ${row[areaCol] || '-'}<br>
          <b>Region:</b> ${row[regionCol] || '-'}
        `;
        
        // Menambahkan marker ke peta
        L.marker([lat, lon])
          .addTo(map)
          .bindPopup(popupContent);
      });
    })
    .catch(err => {
      console.error("Gagal memuat CSV:", err);
    });
</script>

</body>
</html>
