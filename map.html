<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Topology Map - BWA WiBAS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
}

header {
  background: linear-gradient(90deg,#0f172a,#020617);
  color: white;
  padding: 16px;
}

#map {
  height: calc(100vh - 80px);
}
</style>
</head>

<body>

<header>
  <h2>Topology Map – BWA WiBAS</h2>
</header>

<div id="map"></div>
<nav>
  <a href="index.html">Home</a>
  <a href="data.html">Data</a>
  <a href="map.html">Map</a>
</nav>
<script>
const csvFile = 'data.csv';

// INIT MAP
const map = L.map('map').setView([-2.5, 118], 5);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap'
}).addTo(map);

fetch(csvFile)
  .then(res => res.text())
  .then(text => {
    const lines = text.trim().split(/\r?\n/);
    const headers = lines[0].split(',').map(h => h.trim());

    const latCol = headers.find(h => h.toLowerCase().includes('lat'));
    const lonCol = headers.find(h => h.toLowerCase().includes('lon'));
    const nodeCol = headers.find(h => h.toLowerCase().includes('node'));
    const areaCol = headers.find(h => h.toLowerCase().includes('area'));
    const regionCol = headers.find(h => h.toLowerCase().includes('region'));

    const nodes = {};

    lines.slice(1).forEach(line => {
      const v = line.split(',');
      const row = {};
      headers.forEach((h, i) => row[h] = v[i]);

      // Ambil data latitude dan longitude
      const lat = parseFloat(row[latCol]);
      const lon = parseFloat(row[lonCol]);

      // Cek jika lat dan lon valid (angka)
      if (!lat || !lon) return;  // Skip jika latitude atau longitude tidak valid

      const node = row[nodeCol];

      // Hindari duplikat marker node
      if (nodes[node]) return;

      nodes[node] = true;

      // Buat popup untuk marker
      const popup = `
        <b>Node:</b> ${node}<br>
        <b>Area:</b> ${row[areaCol] || '-'}<br>
        <b>Region:</b> ${row[regionCol] || '-'}
      `;

      // Tambahkan marker ke peta hanya jika lat dan lon valid
      L.marker([lat, lon])
        .addTo(map)
        .bindPopup(popup);
    });
  })
  .catch(err => {
    console.error(err);
    alert('Gagal membaca data.csv');
  });

</script>

</body>
</html>
