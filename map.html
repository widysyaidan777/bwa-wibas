<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Peta Topologi – BWA WiBAS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#020617;
  color:white
}
header{
  height:60px;
  display:flex;
  align-items:center;
  padding:0 20px;
  background:linear-gradient(90deg,#0f172a,#020617);
  font-size:22px;
  font-weight:bold
}
#sidebar{
  position:fixed;
  top:60px;
  left:0;
  width:220px;
  height:calc(100vh - 60px);
  background:#020617;
  padding:12px;
  box-sizing:border-box;
  overflow-y:auto;
}
button{
  width:100%;
  margin:4px 0;
  padding:8px;
  border:none;
  border-radius:4px;
  color:white;
  cursor:pointer
}
.blue{background:#2563eb}
.gray{background:#334155}
.red{background:#dc2626}

.submenu{
  display:none;
  margin-left:12px;
}
.submenu button{
  font-size:13px;
  background:#1e293b;
}

#main{
  margin-left:220px;
  height:calc(100vh - 60px);
  display:flex;
  flex-direction:column
}
#map{flex:1}

#toggle{
  text-align:center;
  padding:6px;
  background:#020617;
  border-top:1px solid #334155;
  cursor:pointer
}
#node-section{
  max-height:260px;
  overflow:auto;
  background:#1e293b;
  transition:.3s
}
#node-section.hidden{max-height:0}

table{
  width:100%;
  border-collapse:collapse;
  font-size:13px
}
th,td{
  padding:6px;
  border-bottom:1px solid #334155;
  text-align:left
}
th{background:#020617}
.up{color:#22c55e}
.down{color:#ef4444}

@keyframes blink{
  0%{opacity:1}
  50%{opacity:.35}
  100%{opacity:1}
}
.node-blink{animation:blink 1s infinite}
.node-blink.fast{animation:blink .4s infinite}

.ruler-label{
  background:#020617;
  color:#facc15;
  border:1px solid #facc15;
  padding:4px 8px;
  border-radius:4px;
  font-size:12px;
}
.popup-sector label{
  display:block;
  font-size:12px;
}
</style>
</head>

<body>
<header>Peta Topologi – BWA WiBAS</header>

<div id="sidebar">
  <h4>Area</h4>
  <button class="blue" onclick="showAll()">All</button>

  <button class="gray" onclick="toggleSubmenu('CRO')">CRO ▼</button>
  <div class="submenu" id="submenu-CRO">
    <button onclick="filterRegion('CJDA')">CJDA</button>
    <button onclick="filterRegion('KAA')">KAA</button>
    <button onclick="filterRegion('WJA')">WJA</button>
  </div>

  <hr style="border:1px solid #334155">

  <h4>Coverage</h4>
  <button class="gray" onclick="toggleCoverage()">Toggle Coverage ALL</button>

  <hr style="border:1px solid #334155">

  <h4>Ruler</h4>
  <button class="blue" onclick="activateRuler()">Aktifkan Ruler</button>
  <button class="red" onclick="resetRuler()">Reset Ruler</button>
</div>

<div id="main">
  <div id="map"></div>
  <div id="toggle" onclick="toggleTable()">▲ / ▼</div>
  <div id="node-section">
    <table>
      <thead>
        <tr><th>Node</th><th>Area</th><th>Status</th></tr>
      </thead>
      <tbody id="node-table"></tbody>
    </table>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
/* ================= MAP ================= */
const map = L.map('map').setView([-6.9,110.5],5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

/* ================= ICON ================= */
function icon(colors,fast=false){
  return L.divIcon({
    className:`node-blink ${fast?'fast':''}`,
    iconSize:[36,36],
    iconAnchor:[18,18],
    html:`<svg width="36" height="36" viewBox="0 0 100 100">
      <path d="M50 50 L50 0 A50 50 0 0 1 100 50 Z" fill="${colors[0]}"/>
      <path d="M50 50 L100 50 A50 50 0 0 1 50 100 Z" fill="${colors[1]}"/>
      <path d="M50 50 L50 100 A50 50 0 0 1 0 50 Z" fill="${colors[2]}"/>
      <path d="M50 50 L0 50 A50 50 0 0 1 50 0 Z" fill="${colors[3]}"/>
      <circle cx="50" cy="50" r="9" fill="#020617" stroke="white" stroke-width="2"/>
    </svg>`
  });
}

/* ================= SECTOR ================= */
function createSector(center, radius, startAz, endAz, opt){
  const pts=[center];
  for(let az=startAz; az<=endAz; az+=2){
    const rad=az*Math.PI/180;
    const lat=center.lat+(radius*Math.cos(rad))/111320;
    const lng=center.lng+(radius*Math.sin(rad))/(111320*Math.cos(center.lat*Math.PI/180));
    pts.push([lat,lng]);
  }
  pts.push(center);
  return L.polygon(pts,opt);
}

/* ================= NODE DATA ================= */
const nodes=[
 {name:'SLOSRH',region:'CJDA',lat:-7.563986,lng:110.819334,status:'UP',
 sectorDefs:[{start:0,end:90},{start:90,end:180},{start:180,end:270}]},
 {name:'BLPRAM',region:'KAA',lat:-1.247917,lng:116.838194,status:'DOWN',
 sectorDefs:[{start:45,end:135}]},
 {name:'BDGBBPB',region:'WJA',lat:-6.836141,lng:107.48698,status:'UP',
 sectorDefs:[{start:165,end:255}]},
 {name:'BDGCLY',region:'WJA',lat:-6.940522,lng:107.75132,status:'DOWN',
 sectorDefs:[{start:135,end:225}]},
 {name:'DPSIKT',region:'BNA',lat:-8.735832,lng:115.178706,status:'UP',
 sectorDefs:[{start:175,end:265},{start:350,end:80}]},
 {name:'GRSTGP',region:'EJA',lat:-7.150680,lng:112.646615,status:'UP',
 sectorDefs:[{start:135,end:225},{start:315,end:45}]},
 {name:'MJKGTO',region:'EJA',lat:-7.484068,lng:112.439306,status:'UP',
 sectorDefs:[{start:70,end:160},{start:250,end:340},{start:340,end:70}]},
 {name:'SDJCNG',region:'EJA',lat:-7.407205,lng:112.618979,status:'UP'},
 {name:'SDJSNY',region:'EJA',lat:-7.348534,lng:112.767766,status:'UP',
 sectorDefs:[{start:90,end:180},{start:180,end:270},{start:270,end:360}]},
 {name:'SDJWGP',region:'EJA',lat:-7.376449,lng:112.694152,status:'UP'},
 {name:'SBYGPN',region:'EJA',lat:-7.319528,lng:112.731423,status:'UP'},
 {name:'SBYILT',region:'EJA',lat:-7.272927,lng:112.742805,status:'UP',
 sectorDefs:[{start:180,end:270}]},
 {name:'SBYKYN',region:'EJA',lat:-7.271313,lng:112.744322,status:'UP',
 sectorDefs:[{start:0,end:90},{start:270,end:360}]},
 {name:'SBYPGT',region:'EJA',lat:-7.234389,lng:112.773033,status:'UP',
 sectorDefs:[{start:45,end:135},{start:135,end:225},{start:225,end:315}]},
 {name:'SBYRWJ',region:'EJA',lat:-7.231425,lng:112.729394,status:'UP'},
 {name:'SBYSNR',region:'EJA',lat:-7.275505,lng:112.684784,status:'UP'},
 {name:'SBYSPO',region:'EJA',lat:-7.289116,lng:112.678018,status:'UP',
 sectorDefs:[{start:270,end:360}]},
 {name:'MKSHAM',region:'MAPUA',lat:-5.1480556,lng:119.41046667,status:'UP'},
 {name:'MKSHBR',region:'MAPUA',lat:-5.10165,lng:119.511,status:'DOWN'},
 {name:'CLGIM3',region:'BWA',lat:-6.119008,lng:106.338023,status:'UP'},
 {name:'JKTCIG',region:'BWA',lat:-6.130824,lng:106.735322,status:'UP'},
 {name:'JKTKD2',region:'BWA',lat:-6.188801,lng:106.767965,status:'UP'},
 {name:'SRGSTR',region:'BWA',lat:-6.120406,lng:106.157626,status:'UP'},
 {name:'TGRBLD',region:'BWA',lat:-6.138183,lng:106.659738,status:'DOWN'},
 {name:'TGRCIL',region:'BWA',lat:-6.225322525,lng:106.708201,status:'UP'},
 {name:'TGRCUR',region:'BWA',lat:-6.217032745,lng:106.5673415,status:'UP'},
 {name:'TGRMTH',region:'BWA',lat:-6.229061217,lng:106.6097212,status:'UP'},
 {name:'TGRMUB',region:'BWA',lat:-6.14180778,lng:106.68481951,status:'UP'},
 {name:'TGRSTS',region:'BWA',lat:-6.221908,lng:106.632164,status:'UP'},
 {name:'JKTBRI',region:'BDA',lat:-6.216943,lng:106.813893,status:'UP'},
 {name:'JKTIMP',region:'BDA',lat:-6.210278,lng:106.831211,status:'UP'},
 {name:'JKTHST',region:'CDA',lat:-6.192211,lng:106.864625,status:'UP'},
 {name:'JKTMNC',region:'CDA',lat:-6.184064,lng:106.831195,status:'UP'},
 {name:'JKTASK',region:'NEA',lat:-6.12725,lng:106.805,status:'UP'},
 {name:'JKTGKR',region:'NEA',lat:-6.15129,lng:106.8872,status:'UP'},
 {name:'JKTKGD',region:'NEA',lat:-6.171444,lng:106.916252,status:'UP'},
 {name:'JKTPTC',region:'NEA',lat:-6.183722,lng:106.915222,status:'UP'},
 {name:'JKTBDR',region:'SAST',lat:-6.29100,lng:106.78655,status:'UP'},
 {name:'TGRAJS',region:'SAST',lat:-6.2958,lng:106.6802,status:'UP'},
 {name:'TGRBIA',region:'SAST',lat:-6.2705,lng:106.7091,status:'UP'},
 {name:'BKSCRW',region:'SEOA',lat:-6.330000,lng:107.134489,status:'UP'},
 {name:'BKSHHR',region:'SEOA',lat:-6.2483,lng:106.99084,status:'UP'},
 {name:'BKSJBB',region:'SAST',lat:-6.296083,lng:107.162247,status:'UP'},
 {name:'PBRSDU',region:'CSA',lat:0.51185,lng:101.449133,status:'UP'},
 {name:'BDALTH',region:'NSA',lat:5.551675,lng:95.345611,status:'UP'},
 {name:'MDNCMB',region:'NSA',lat:5.2194761,lng:0.135512,status:'UP'},
 {name:'MDNIDS',region:'NSA',lat:3.599222,lng:98.686306,status:'UP'},
 {name:'MDNTGM',region:'NSA',lat:3.541423,lng:98.809228,status:'UP'},
 {name:'BKLHST',region:'SSA',lat:-3.79793,lng:102.27345,status:'UP'},
 {name:'BKLPDH',region:'SSA',lat:-3.82776,lng:102.29074,status:'UP'},
 {name:'PKPRKI',region:'SSA',lat:-2.15641,lng:106.13115,status:'UP'},
 {name:'PLBBSG',region:'SSA',lat:-2.9982961,lng:104.7240517,status:'UP'},
 {name:'PLBKBN',region:'SSA',lat:-2.9200622,lng:104.7226304,status:'UP'},
];

/* ================= CREATE NODE + SECTOR ================= */
let coverageVisible=true;

nodes.forEach(n=>{
  const col = n.status==='UP'
    ? ['#2563eb','#22c55e','#2563eb','#22c55e']
    : ['#dc2626','#f97316','#dc2626','#f97316'];

  n.marker=L.marker([n.lat,n.lng],{
    icon:icon(col,n.status==='DOWN')
  }).addTo(map);

  n.sectors=[];
  n.sectorDefs.forEach((sec,i)=>{
    const s=createSector(
      L.latLng(n.lat,n.lng),
      5000,
      sec.start,
      sec.end,
      {color:col[i%4],fillColor:col[i%4],fillOpacity:.25,weight:1}
    ).addTo(map);
    s.visible=true;
    n.sectors.push(s);
  });

  /* ===== POPUP SECTOR CONTROL ===== */
  let html=`<b>${n.name}</b><br><div class="popup-sector">`;
  n.sectors.forEach((s,i)=>{
    html+=`
      <label>
        <input type="checkbox" checked
          onchange="toggleSector('${n.name}',${i},this.checked)">
        Sector ${i+1}
      </label>`;
  });
  html+=`</div>`;
  n.marker.bindPopup(html);
});

/* ================= TOGGLE FUNCTIONS ================= */
function toggleCoverage(){
  coverageVisible=!coverageVisible;
  nodes.forEach(n=>{
    n.sectors.forEach(s=>{
      coverageVisible ? s.addTo(map) : map.removeLayer(s);
    });
  });
}

function toggleSector(nodeName,idx,state){
  const n=nodes.find(x=>x.name===nodeName);
  const s=n.sectors[idx];
  state ? s.addTo(map) : map.removeLayer(s);
}

/* ================= TABLE ================= */
function render(list){
  const tb=document.getElementById('node-table');
  tb.innerHTML='';
  list.forEach(n=>{
    tb.innerHTML+=`
      <tr onclick="focusNode('${n.name}')" style="cursor:pointer">
        <td>${n.name}</td>
        <td>${n.region}</td>
        <td class="${n.status==='UP'?'up':'down'}">${n.status}</td>
      </tr>`;
  });
}
function focusNode(name){
  const n=nodes.find(x=>x.name===name);
  map.flyTo([n.lat,n.lng],11,{animate:true});
  n.marker.openPopup();
}
function showAll(){
  render(nodes);
  nodes.forEach(n=>{
    n.marker.addTo(map);
    n.sectors.forEach(s=>coverageVisible&&s.addTo(map));
  });
}
function toggleTable(){
  document.getElementById('node-section').classList.toggle('hidden');
}
showAll();
</script>
</body>
</html>
