<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Peta Topologi – BWA WiBAS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }

    header {
      background: linear-gradient(90deg,#0f172a,#020617);
      color: white;
      padding: 16px;
      display: flex;
      align-items: center;
    }

    /* ===== SIDEBAR ===== */
    #sidebar {
      position: absolute;
      top: 64px;
      left: 0;
      width: 200px;
      height: calc(100vh - 64px);
      background: #1e293b;
      color: white;
      padding: 10px;
      z-index: 1000;
    }

    #sidebar h3 {
      margin-top: 0;
      font-size: 16px;
    }

    #sidebar button {
      width: 100%;
      margin-bottom: 8px;
      padding: 8px;
      border: none;
      border-radius: 4px;
      background: #3b82f6;
      color: white;
      cursor: pointer;
    }

    #sidebar button:hover {
      background: #2563eb;
    }

    /* ===== MAP ===== */
    #map {
      margin-left: 200px;
      height: calc(100vh - 160px);
    }

    #back-button {
      margin-left: 210px;
      margin-top: 10px;
      padding: 10px 15px;
      font-size: 16px;
      background-color: #333;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #back-button:hover {
      background-color: #555;
    }
  </style>
</head>

<body>

<header>
  <h2>Peta Topologi – BWA WiBAS</h2>
</header>

<!-- SIDEBAR -->
<div id="sidebar">
  <h3>Daftar Node</h3>
  <button onclick="showAllNodes()">All</button>
  <button onclick="showNode('node1')">Node 1</button>
</div>

<div id="map"></div>

<button id="back-button" onclick="window.location.href='index.html';">
  Kembali ke Menu
</button>

<script>
  /* ===== MAP INIT ===== */
  const map = L.map('map').setView([-6.291, 106.786], 12);

  L.tileLayer('https://api.maptiler.com/maps/streets-v4/{z}/{x}/{y}.png?key=fI3LpQe8kMXj5ntFo68C', {
    attribution: '© MapTiler © OpenStreetMap contributors'
  }).addTo(map);

  /* ===== NODE DATA ===== */
  const nodes = {};

  const latLng1 = [-6.291, 106.786];

  function getSectorCoordinates(center, angle, radius) {
    const rad = angle * (Math.PI / 180);
    return [
      center[0] + (radius * Math.cos(rad)),
      center[1] + (radius * Math.sin(rad))
    ];
  }

  function drawSector(center, start, end, radius, color) {
    const coords = [center];
    if (start < end) {
      for (let a = start; a <= end; a++) {
        coords.push(getSectorCoordinates(center, a, radius));
      }
    } else {
      for (let a = start; a <= 360; a++) {
        coords.push(getSectorCoordinates(center, a, radius));
      }
      for (let a = 0; a <= end; a++) {
        coords.push(getSectorCoordinates(center, a, radius));
      }
    }

    return L.polygon(coords, {
      color,
      fillColor: color,
      fillOpacity: 0.5
    });
  }

  /* ===== NODE 1 ===== */
  const node1Layers = [];

  node1Layers.push(
    drawSector(latLng1, 45, 135, 0.05, 'green'),
    drawSector(latLng1, 135, 225, 0.05, 'orange'),
    drawSector(latLng1, 225, 315, 0.05, 'red'),
    drawSector(latLng1, 315, 45, 0.05, 'yellow'),
    L.circleMarker(latLng1, {
      radius: 10,
      color: 'blue',
      fillColor: 'blue',
      fillOpacity: 0.8
    }).bindPopup('Node 1 - Pusat Sinyal')
  );

  nodes.node1 = node1Layers;

  /* ===== SHOW FUNCTIONS ===== */
  function clearMap() {
    Object.values(nodes).forEach(group => {
      group.forEach(layer => map.removeLayer(layer));
    });
  }

  function showNode(name) {
    clearMap();
    nodes[name].forEach(layer => layer.addTo(map));
  }

  function showAllNodes() {
    clearMap();
    Object.values(nodes).forEach(group => {
      group.forEach(layer => layer.addTo(map));
    });
  }

  /* tampilkan semua saat load */
  showAllNodes();
</script>

</body>
</html>
