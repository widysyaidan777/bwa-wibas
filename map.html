<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Topology Map – BWA WiBAS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
}

header {
  background: linear-gradient(90deg,#0f172a,#020617);
  color: white;
  padding: 16px;
}

#map {
  height: calc(100vh - 80px);
}
</style>
</head>

<body>

<header>
  <h2>Topology Map – BWA WiBAS</h2>
</header>

<div id="map"></div>
<nav>
  <a href="index.html">Home</a>
  <a href="data.html">Data</a>
  <a href="wibas.html">WiBAS</a>
  <a href="map.html">Map</a>
</nav>
<script>
  const map = L.map('map').setView([-6.291, 106.786], 5);  // Set initial view for the map
  
  // Add OpenStreetMap Tile Layer
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap'
  }).addTo(map);

  const csvFile = 'map.csv';  // Path to your CSV file

  fetch(csvFile)
    .then(res => res.text())
    .then(text => {
      const lines = text.trim().split(/\r?\n/);
      const headers = lines[0].split(',');

      // Identifying the necessary columns
      const latCol = headers.find(h => h.toLowerCase().includes('latitude'));
      const lonCol = headers.find(h => h.toLowerCase().includes('longitude'));
      const sectorCol = headers.find(h => h.toLowerCase().includes('sector name'));
      const ipCol = headers.find(h => h.toLowerCase().includes('user label'));

      if (!latCol || !lonCol || !sectorCol || !ipCol) {
        console.error("One or more columns are missing.");
        return;
      }

      // Process each line in CSV
      lines.slice(1).forEach(line => {
        const values = line.split(',');
        const lat = parseFloat(values[headers.indexOf(latCol)]);  // Ensure latitude is a float
        const lon = parseFloat(values[headers.indexOf(lonCol)]); // Ensure longitude is a float
        const sector = values[headers.indexOf(sectorCol)];
        const ip = values[headers.indexOf(ipCol)];

        // Skip invalid lat/lon
        if (isNaN(lat) || isNaN(lon)) return;

        // Popup content with correct lat and lon
        const popupContent = `
          <b>Sector:</b> ${sector}<br>
          <b>IP:</b> ${ip || 'N/A'}<br>
          <b>Latitude:</b> ${lat}<br>
          <b>Longitude:</b> ${lon}
        `;
        
        // Add marker to the map
        L.marker([lat, lon]).addTo(map).bindPopup(popupContent);
      });
    })
    .catch(err => {
      console.error("Failed to load CSV:", err);
    });
</script>


</body>
</html>
