<script>
  const map = L.map('map').setView([-6.291, 106.786], 5);  // Menetapkan posisi peta awal
  
  // Menambahkan Lapisan Tile OpenStreetMap
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap'
  }).addTo(map);

  // Data contoh untuk node dan sektor: Latitude, Longitude, dan Informasi Sektor
  const nodeData = [
    {
      lat: -6.291,
      lon: 106.786,
      node: 'Node 1 - Jawa Barat',
      status: 'online', // Status online
      region: 'CRO - West Java Area',
      sectors: [
        { sector: 'slosrh180', ip: '172.31.141.2' },
        { sector: 'slosrh181', ip: '172.31.142.3' },
        { sector: 'slosrh182', ip: '172.31.143.4' },
        { sector: 'slosrh183', ip: '172.31.144.5' }
      ]
    },
    {
      lat: -6.836141,
      lon: 107.48698,
      node: 'Node 2 - Jawa Timur',
      status: 'offline', // Status offline
      region: 'CRO - East Java Area',
      sectors: [
        { sector: 'slosrh190', ip: '172.31.147.2' },
        { sector: 'slosrh191', ip: '172.31.148.3' }
      ]
    },
    // Node lainnya bisa ditambahkan di sini
  ];

  let currentPopup = null;  // Variabel untuk menyimpan popup yang sedang terbuka

  // Menambahkan marker untuk setiap node
  nodeData.forEach(node => {
    let popupContent = `<b>Node:</b> ${node.node}<br><b>Region:</b> ${node.region}<br><b>Lokasi:</b><br>Latitude: ${node.lat}<br>Longitude: ${node.lon}`;
    
    // Menampilkan semua sektor yang terkait dengan node
    node.sectors.forEach(sector => {
      popupContent += `<br><b>${sector.sector}:</b> IP: ${sector.ip}`;
    });

    // Menentukan ikon berdasarkan status (hijau untuk online, merah untuk offline)
    const iconUrl = node.status === 'online' ? 
      'https://github.com/widysyaidan777/bwa-wibas/blob/main/icons8-gps-signal-64%20(1).png?raw=true' : 
      'https://github.com/widysyaidan777/bwa-wibas/blob/main/icons8-gps-signal-64.png?raw=true';

    // Menambahkan marker untuk node dengan ikon yang sesuai status menggunakan L.icon
    const nodeMarker = L.marker([node.lat, node.lon], {
      icon: L.icon({
        iconUrl: iconUrl,
        iconSize: [40, 40], // Ukuran ikon
        iconAnchor: [20, 40], // Titik anchor ikon
        popupAnchor: [0, -40] // Menentukan posisi popup di atas marker
      })
    }).addTo(map).bindPopup(popupContent);
    
    // Menambahkan interaksi klik untuk setiap sektor dalam node
    node.sectors.forEach(sector => {
      const sectorContent = `<br><b>${sector.sector}:</b> IP: ${sector.ip}`;
      
      // Menambahkan marker untuk sektor
      const sectorMarker = L.marker([node.lat, node.lon], { icon: nodeMarker.options.icon }).addTo(map)
        .on('click', function () {
          // Menutup popup yang sebelumnya terbuka
          if (currentPopup) {
            currentPopup.remove();
          }
          // Menampilkan popup untuk sektor yang baru dipilih
          currentPopup = L.popup()
            .setLatLng([node.lat, node.lon])
            .setContent(popupContent + sectorContent)
            .openOn(map);
        });
    });
  });
</script>

