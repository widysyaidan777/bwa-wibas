<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Peta Topologi – BWA WiBAS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }

    header {
      background: linear-gradient(90deg,#0f172a,#020617);
      color: white;
      padding: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .menu-btn {
      display: none;
      font-size: 22px;
      cursor: pointer;
    }

    /* ===== SIDEBAR ===== */
    #sidebar {
      position: fixed;
      top: 64px;
      left: 0;
      width: 220px;
      height: calc(100vh - 64px);
      background: #1e293b;
      color: white;
      padding: 10px;
      z-index: 1000;
      transition: transform 0.3s ease;
    }

    #sidebar h3 {
      margin-top: 0;
      font-size: 16px;
    }

    #sidebar button {
      width: 100%;
      margin-bottom: 8px;
      padding: 10px;
      border: none;
      border-radius: 4px;
      background: #3b82f6;
      color: white;
      cursor: pointer;
    }

    #sidebar button:hover {
      background: #2563eb;
    }

    /* ===== MAP ===== */
    #map {
      margin-left: 220px;
      height: calc(100vh - 160px);
      transition: margin-left 0.3s ease;
    }

    #back-button {
      margin-left: 230px;
      margin-top: 10px;
      padding: 10px 15px;
      font-size: 16px;
      background-color: #333;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px) {
      .menu-btn {
        display: block;
      }

      #sidebar {
        transform: translateX(-100%);
      }

      #sidebar.active {
        transform: translateX(0);
      }

      #map {
        margin-left: 0;
      }

      #back-button {
        margin-left: 10px;
      }
    }
  </style>
</head>

<body>

<header>
  <h2>Peta Topologi – BWA WiBAS</h2>
  <span class="menu-btn" onclick="toggleSidebar()">☰</span>
</header>

<!-- SIDEBAR -->
<div id="sidebar">
  <h3>Daftar Node</h3>
  <button onclick="showAllNodes()">All</button>
  <button onclick="showNode('node1')">Node 1</button>
  <button onclick="showNode('node2')">Node 2</button>
  <button onclick="showNode('node3')">Node 3</button>
</div>

<div id="map"></div>

<button id="back-button" onclick="window.location.href='index.html';">
  Kembali ke Menu
</button>

<script>
  /* ===== SIDEBAR TOGGLE ===== */
  function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('active');
  }

  /* ===== MAP INIT ===== */
  const map = L.map('map').setView([-6.291, 106.786], 12);

  L.tileLayer('https://api.maptiler.com/maps/streets-v4/{z}/{x}/{y}.png?key=fI3LpQe8kMXj5ntFo68C', {
    attribution: '© MapTiler © OpenStreetMap contributors'
  }).addTo(map);

  /* ===== HELPER ===== */
  function getSectorCoordinates(center, angle, radius) {
    const rad = angle * (Math.PI / 180);
    return [
      center[0] + (radius * Math.cos(rad)),
      center[1] + (radius * Math.sin(rad))
    ];
  }

  function drawSector(center, start, end, radius, color) {
    const coords = [center];
    if (start < end) {
      for (let a = start; a <= end; a++) coords.push(getSectorCoordinates(center, a, radius));
    } else {
      for (let a = start; a <= 360; a++) coords.push(getSectorCoordinates(center, a, radius));
      for (let a = 0; a <= end; a++) coords.push(getSectorCoordinates(center, a, radius));
    }
    return L.polygon(coords, { color, fillColor: color, fillOpacity: 0.5 });
  }

  const nodes = {};

  function createNode(name, center, zoom, color) {
    const layers = [];

    layers.push(
      drawSector(center, 45, 135, 0.05, color),
      drawSector(center, 135, 225, 0.05, color),
      drawSector(center, 225, 315, 0.05, color),
      drawSector(center, 315, 45, 0.05, color),
      L.circleMarker(center, {
        radius: 10,
        color,
        fillColor: color,
        fillOpacity: 0.9
      }).bindPopup(name)
    );

    nodes[name] = { layers, center, zoom };
  }

  /* ===== CREATE NODES ===== */
  createNode('node1', [-6.291, 106.786], 14, 'blue');
  createNode('node2', [-6.260, 106.800], 14, 'green');
  createNode('node3', [-6.320, 106.760], 14, 'red');

  /* ===== CONTROL ===== */
  function clearMap() {
    Object.values(nodes).forEach(n =>
      n.layers.forEach(l => map.removeLayer(l))
    );
  }

  function showNode(name) {
    clearMap();
    nodes[name].layers.forEach(l => l.addTo(map));
    map.flyTo(nodes[name].center, nodes[name].zoom, { duration: 1 });

    if (window.innerWidth <= 768) {
      document.getElementById('sidebar').classList.remove('active');
    }
  }

  function showAllNodes() {
    clearMap();
    Object.values(nodes).forEach(n =>
      n.layers.forEach(l => l.addTo(map))
    );
  }

  showAllNodes();
</script>

</body>
</html>
