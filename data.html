<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Data BWA WiBAS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial; margin:0; background:#f4f6f8; }
header { background:#0f172a; color:white; padding:16px; }
nav { background:#1e293b; padding:10px; }
nav a { color:white; margin-right:15px; text-decoration:none; }
.container { padding:20px; }
table { width:100%; border-collapse:collapse; background:white; }
th, td { padding:8px; border:1px solid #ddd; }
th { background:#f1f5f9; cursor:pointer; }
button { padding:6px 10px; cursor:pointer; }
.toolbar { margin-bottom:10px; }
input { padding:6px; }
.edit-btn { background:#2563eb; color:white; }
.delete-btn { background:#dc2626; color:white; }
.add-btn { background:#16a34a; color:white; margin-bottom:10px; }
</style>
</head>

<body>

<header>
<h2>Data BWA WiBAS</h2>
</header>

<nav>
<a href="index.html">Profil</a>
<a href="data.html">Data WiBAS</a>
</nav>

<div class="container">

<div class="toolbar">
<input id="search" placeholder="Search...">
<button class="add-btn" onclick="addData()">Tambah Data</button>
</div>

<table>
<thead>
<tr id="thead"></tr>
</thead>
<tbody id="tbody"></tbody>
</table>

</div>

<script type="module">

// ================= FIREBASE CONFIG =================
import { initializeApp } from 
"https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

import { getFirestore, collection, getDocs, addDoc, 
updateDoc, deleteDoc, doc } from 
"https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA1XId1RBwjyv1_OUmbWy2reMm6eGMcV-M",
  authDomain: "dashboard-bwa.firebaseapp.com",
  projectId: "dashboard-bwa",
  storageBucket: "dashboard-bwa.firebasestorage.app",
  messagingSenderId: "1066238404578",
  appId: "1:1066238404578:web:ad4b911ac3f155352e3bbb"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ================= DATA =================
let data = [];
let filtered = [];

// ================= LOAD DATA =================
async function loadData() {
  const snapshot = await getDocs(collection(db, "wibas"));
  data = [];
  snapshot.forEach(d => {
    data.push({ id: d.id, ...d.data() });
  });
  filtered = [...data];
  render();
}

loadData();

// ================= RENDER =================
function render() {
  if (!filtered.length) return;

  const headers = Object.keys(filtered[0]).filter(h => h !== "id");
  const thead = document.getElementById("thead");
  const tbody = document.getElementById("tbody");

  thead.innerHTML = "";
  tbody.innerHTML = "";

  headers.forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    thead.appendChild(th);
  });

  const thAction = document.createElement("th");
  thAction.textContent = "Action";
  thead.appendChild(thAction);

  filtered.forEach(row => {
    const tr = document.createElement("tr");

    headers.forEach(h => {
      const td = document.createElement("td");
      td.textContent = row[h];
      tr.appendChild(td);
    });

    const actionTd = document.createElement("td");

    const editBtn = document.createElement("button");
    editBtn.textContent = "Edit";
    editBtn.className = "edit-btn";
    editBtn.onclick = () => editData(row);

    const delBtn = document.createElement("button");
    delBtn.textContent = "Delete";
    delBtn.className = "delete-btn";
    delBtn.onclick = () => deleteData(row.id);

    actionTd.appendChild(editBtn);
    actionTd.appendChild(delBtn);

    tr.appendChild(actionTd);
    tbody.appendChild(tr);
  });
}

// ================= SEARCH =================
document.getElementById("search").addEventListener("input", e => {
  const q = e.target.value.toLowerCase();
  filtered = data.filter(row =>
    Object.values(row).join(" ").toLowerCase().includes(q)
  );
  render();
});

// ================= ADD =================
async function addData() {
  const name = prompt("Nama Site:");
  const state = prompt("State:");
  const terminal = prompt("Total Terminal:");

  if (!name) return;

  await addDoc(collection(db, "wibas"), {
    "Site Name": name,
    "State": state || "",
    "Total Terminal": terminal || ""
  });

  loadData();
}

// ================= EDIT =================
async function editData(row) {
  const name = prompt("Nama Site:", row["Site Name"]);
  const state = prompt("State:", row["State"]);
  const terminal = prompt("Total Terminal:", row["Total Terminal"]);

  await updateDoc(doc(db, "wibas", row.id), {
    "Site Name": name,
    "State": state,
    "Total Terminal": terminal
  });

  loadData();
}

// ================= DELETE =================
async function deleteData(id) {
  if (!confirm("Yakin hapus data?")) return;
  await deleteDoc(doc(db, "wibas", id));
  loadData();
}

</script>

</body>
</html>
