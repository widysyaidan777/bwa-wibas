<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Data BWA WiBAS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
 body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  overflow-x: hidden;   /* ðŸ”¥ penting supaya header tidak ikut geser */
}
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
}

header, nav {
  width: 100%;
}

header {
  background: #ffffff; /* putih */
  color: #000000; /* teks hitam */
  padding: 10px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #ddd;
}

nav {
  background: #ffffff;
  padding: 12px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #ddd;
  position: sticky;
  top: 0;
  z-index: 100;
}

nav .menu-links {
  display: flex;
  gap: 20px;
}

nav a {
  text-decoration: none;
  color: #000000;
  font-weight: 600;
  transition: color 0.3s;
}

nav a:hover { color: #2563eb; }
nav a {
  color: #000000;
  font-weight: bold;
  margin-right: 20px;
  text-decoration: none;
}
nav a:hover {
  color: #2563eb; /* aksen biru saat hover */
}
nav {
  overflow: visible;
}    
   .container {
  width: 100%;
  padding: 24px;
  box-sizing: border-box;
}
    input {
  padding: 6px 10px;
  width: 300px;      /* atur lebar di sini */
  font-size: 14px;
}

   table {
  width: max-content;
  table-layout: auto;
  border-collapse: collapse;
  background: white;
}
.table-wrapper {
  width: 100%;
  overflow-x: auto;   /* scroll hanya di tabel */
}

    th, td {
      padding: 10px;
      border: 1px solid #e5e7eb;
      text-align: left;
    }

    th {
      cursor: pointer;
      background: #f1f5f9;
      border-top: 2px solid #e5e7eb; /* Menambahkan border atas untuk header */
    }

    td {
      border-top: 1px solid #e5e7eb; /* Border atas pada setiap cell data */
    }

    footer {
      margin-top: 30px;
      padding: 24px;
      text-align: center;
      background: #020617;
      color: white;
    }

    .pagination {
      margin-top: 15px;
    }

    .pagination button {
      padding: 6px 12px;
      margin-right: 4px;
    }

  </style>
</head>
<body>


<nav>
  <a href="index.html">WiBAS 10.5 GHz</a>
  <a href="data.html">Data WiBAS</a>
  <a href="wibas.html">Statistic WiBAS</a>
  <a href="map.html">Topology</a>
  <a href="incident.html">Incident WiBAS</a>
</nav>

<div class="container">

<div class="toolbar">
<input id="search" placeholder="Search...">
<button class="add-btn" onclick="openModal()">Tambah Data</button>

<div style="margin-top:10px; display:flex; gap:10px; align-items:center;">
     
    <input type="file" id="importFile" accept=".csv">
    <button onclick="importCSV()">Import CSV</button>
    <button onclick="exportCSV()">Export CSV</button>
    <!-- Refresh Icon -->
    <button id="btnRefresh"
            style="background:none;border:none;cursor:pointer;font-size:18px;">
        ðŸ”„
    </button>


</div>
<div class="table-wrapper">
  <table>
    <thead><tr id="thead"></tr></thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

</div>

<!-- MODAL FORM -->
<div id="modal" class="modal">
<div class="modal-content">
<span class="close" onclick="closeModal()">X</span>
<h3 id="formTitle">Tambah Data</h3>
<div id="formFields"></div>
<button onclick="saveData()">Save</button>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script type="module">

import { initializeApp } from 
"https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

import { getFirestore, collection, getDocs, addDoc, 
updateDoc, deleteDoc, doc, query, orderBy } from 
"https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA1XId1RBwjyv1_OUmbWy2reMm6eGMcV-M",
  authDomain: "dashboard-bwa.firebaseapp.com",
  projectId: "dashboard-bwa",
  storageBucket: "dashboard-bwa.firebasestorage.app",
  messagingSenderId: "1066238404578",
  appId: "1:1066238404578:web:ad4b911ac3f155352e3bbb"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ===== KOLOM TETAP SESUAI CSV =====
const columns = [
"No","Region","Area","Node","Sector Name","ME",
"User Label","Total Terminal","SW Version",
"MAC Adress","Resource Type","Contact","Location",
"Latitude","Longitude","Connectivity","State",
"Distance (m)","Bandwidth","Service Remote"
];

let data = [];
let filtered = [];
let editId = null;

// ===== LOAD DATA =====
async function loadData() {

  const q = query(
    collection(db, "wibas"),
    orderBy("No", "asc")
  );

  const snapshot = await getDocs(q);

  data = [];
  snapshot.forEach(d => {
    data.push({ id: d.id, ...d.data() });
  });

  filtered = [...data];
  render();
}

loadData();

// ===== RENDER TABLE =====
function render() {
  const thead = document.getElementById("thead");
  const tbody = document.getElementById("tbody");

  thead.innerHTML = "";
  tbody.innerHTML = "";

  columns.forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    thead.appendChild(th);
  });

  const thAction = document.createElement("th");
  thAction.textContent = "Action";
  thead.appendChild(thAction);

  filtered.forEach(row => {
    const tr = document.createElement("tr");
    
columns.forEach(h => {
  const td = document.createElement("td");
  td.textContent = row[h] || "";

  if (h === "State") {
    const value = (row[h] || "").toLowerCase();
    if (value.includes("inactive") || value.includes("dismantle")) {
      td.style.color = "red";
      td.style.fontWeight = "bold";
    }
  }

  if (h === "Connectivity") {
    const value = (row[h] || "").toLowerCase();
    if (value.includes("unreachable")) {
      td.style.color = "red";
      td.style.fontWeight = "bold";
    }
  }

  tr.appendChild(td);
});

    const actionTd = document.createElement("td");

    const editBtn = document.createElement("button");
    editBtn.textContent = "Edit";
    editBtn.className = "edit-btn";
    editBtn.onclick = () => openModal(row);

    const delBtn = document.createElement("button");
    delBtn.textContent = "Delete";
    delBtn.className = "delete-btn";
    delBtn.onclick = async () => {
      if(confirm("Yakin hapus?")){
        await deleteDoc(doc(db,"wibas",row.id));
        loadData();
      }
    };

    actionTd.appendChild(editBtn);
    actionTd.appendChild(delBtn);
    tr.appendChild(actionTd);
    tbody.appendChild(tr);
  });
}

// ===== SEARCH =====
document.getElementById("search").addEventListener("input", e => {
  const q = e.target.value.toLowerCase();
  filtered = data.filter(row =>
    Object.values(row).join(" ").toLowerCase().includes(q)
  );
  render();
});

// ===== MODAL =====
window.openModal = function(row=null){
  document.getElementById("modal").style.display="block";
  const form = document.getElementById("formFields");
  form.innerHTML="";
  editId = null;

  columns.forEach(col=>{
    const input = document.createElement("input");
    input.placeholder = col;
    input.id = col;
    if(row) input.value = row[col] || "";
    form.appendChild(input);
  });

  if(row) editId = row.id;
}

window.closeModal = function(){
  document.getElementById("modal").style.display="none";
}

// ===== SAVE =====
window.saveData = async function(){

  let obj = {};
  columns.forEach(col=>{
    obj[col] = document.getElementById(col).value;
  });

  if(editId){
    await updateDoc(doc(db,"wibas",editId),obj);
  } else {
    await addDoc(collection(db,"wibas"),obj);
  }

  closeModal();
  loadData();
}
window.importCSV = function() {
  const file = document.getElementById("importFile").files[0]; // sesuai ID input
  if (!file) {
    alert("Pilih file CSV dulu!");
    return;
  }

  Papa.parse(file, {
    header: true,
    skipEmptyLines: true,
    complete: async function(results) {

      const rows = results.data;

      for (let row of rows) {
        // Ubah No jadi number supaya bisa di-sort dengan benar
        if (row["No"]) {
          row["No"] = Number(row["No"]);
        }
        await addDoc(collection(db, "wibas"), row);
      }

      alert("Import selesai! Data sudah permanen.");
      loadData();
    }
  });
};
  
  window.exportCSV = function() {

  if (!filtered.length) {
    alert("Tidak ada data untuk di-export");
    return;
  }

  let csvContent = "";

  // Header
  csvContent += columns.join(",") + "\n";

  // Data
  filtered.forEach(row => {
    let rowData = columns.map(col => {
      let value = row[col] || "";
      return `"${value}"`; // pakai tanda kutip supaya aman
    });
    csvContent += rowData.join(",") + "\n";
  });

  // Buat file
  const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
  const link = document.createElement("a");

  link.href = URL.createObjectURL(blob);
  link.download = "data_wibas_export.csv";
  link.click();
};
document.getElementById("btnRefresh")
  .addEventListener("click", async function() {

      console.log("Manual refresh dijalankan");

      await loadData();

      alert("Data berhasil direfresh");

});
const links = document.querySelectorAll("nav .menu-links a");

links.forEach(link => {
  if (link.href === window.location.href) {
    link.classList.add("active");
  }
});
</script>

</body>
</html>




